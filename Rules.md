# 開発する上で必要な知識

## FORTRAN77 を書く上でのルール

- 大文字小文字の区別はない
- 1 行は 7-72 列の 66 文字まで書ける
- コメントは"!"または"c"を用いる
- 一行に入りきらない場合は"\&"または数字を用いて次の行につなげることが可能
- PARAMETER 文は代入文より先に書かなければならない
- 暗黙の型宣言の無効化が推奨される(implicit none)
- キーワード引数は使えない
- PRESENT 文は OPTIONAL 引数に対してのみ使用できる
- OPTIONAL 文は書かなくても良い(書かなくても引数は省略可能)
- 加算代入、減算代入はできないっぽい
- 各計算用組込関数には返り値の型を指定する機能がある(abs,dabs,sqrt,dsqrt など)
- サブルーチンに配列を渡す際は配列の先頭要素を指定しても良いし、配列そのものを直接指定しても良い
- 配列の出力には`WRITE(6,*) STRESS`のように配列名を書くだけで良い(インデックスの記述はいらない)
- 配列同士の加減乗除はインデックスを使わなくても可能、配列とスカラーも同様
- 行列に配列を代入することも可能(スライスを用いて指定する, a(1,:) = b など)
- 配列に代入するときは、それが配列だとわかるよう、(:)を用いて明示的にする
- function を宣言する際、型の宣言は引数の順に宣言する必要がある?
- function で配列を返す際は要注意、謎の挙動をする
- 組込関数の dot_product,matmul を使おう

## ABAQUS で UMAT を実装する上でのルール

- WRITE 文 の装置識別子は dat ファイルに出力する場合 6,msg ファイルに出力する場合 7 を用いる
- WRITE 文の中でエラーハンドリング実装の関数を呼び出した場合、返り値を返さないと解析自体がエラーとなってストップする
- 上記の項目で WRITE 文外でエラーを発生させた場合、返り値には 0 が入っている(返り値の型によるかどうかは不明)
- ABAQUS 由来の組込関数,組込引数、FORTRAN の組込関数、ユーザー定義の定数は全て大文字とする
- ユーザー定義の変数、関数、サブルーチンは全て lowerCamel とする
- コードを短縮するために定義する変数がある、これらは UpperCamel で記述するものとする
- 大文字と小文字が入り乱れるので、変数名が重複しないように注意する
- 変数名の接頭辞
  |接頭辞|意味|
  |:--:|:--:|
  |e|弾性|
  |p|塑性|
  |eq|相当|
  |num|数量|
  |db|double|
  |yld|yld2004 に関する変数|
  |hard|硬化則に関する変数|
  |pri|主値,principal の pri|

  eqPStrain: 相当塑性ひずみ

  numIteration: 繰り返しの数

  sPrime: s'

  sDbPrime: s"

  yldT: yld2004 で使用するテンソル T

- DDSDDE の D は Δ、もしくは ∂ のこと?

### UMAT で行わなければならないのは二つ

- STRESS を更新すること
- DDSDDE(ヤコビ行列)を返すこと

  ABAQUS の陰解法で用いられるヤコビ行列を返す必要があり、収束できる程度に正確であれば良い

### 計算用サブルーチンに関して

- テンソルの主値を計算することができる SPRINC というサブルーチンが存在する。非常に有用なので使うべき
- XIT も良い(解析を stop できる)

ホーナー法、ガウスザイデル法
